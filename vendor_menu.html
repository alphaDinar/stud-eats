<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/eb75260fb3.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,300,0,0" />
  <link rel="stylesheet" href="css/base.css">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"
    integrity="sha512-z4OUqw38qNLpn1libAN9BsoDx6nbNFio5lA6CuTp9NlK83b89hgyCVq+N5FdBJptINztxn1Z3SaKSKUS5UP60Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="css/component.css">
  <link rel="stylesheet" href="css/vendors.css">
  <link rel="stylesheet" href="css/vendor_menu.css">
  <title>Document</title>
</head>

<body>
  <section class="page">
    <section class="page_cover" onclick="closeFilter()"></section>
    <nav class="top_nav">
      <div>
        <a href="vendors.html" class="material-symbols-outlined">arrow_back</a>
        <img src="images/omar.png" alt="" onclick="openPanel()">
        <small onclick="openPanel()">Hi Omar</small>
      </div>
      <div>
        <i class="material-symbols-outlined">notifications</i>
        <a style="position: relative; display: flex; align-items: center;" onclick="toggleCart()">
          <i class="material-symbols-outlined">shopping_cart</i>
          <small class="cart_counter">0</small>
        </a>
      </div>
    </nav>

    <nav class="user_panel">
      <header>
        <img src="images/omar.png" alt="" width="80px" style="aspect-ratio: 4/3; object-fit: contain;">
        <span>Omar</span>
      </header>
      <section>
        <a href=""><i class="material-symbols-outlined">restaurant</i> <span>My Orders</span></a>
        <a href=""><i class="material-symbols-outlined">person</i> <span>My Profile</span></a>
        <a href=""><i class="material-symbols-outlined">pin_drop</i> <span>Delivery Adderss</span></a>
        <a href=""><i class="material-symbols-outlined">credit_card</i> <span>Payment Methods</span></a>
        <a href=""><i class="material-symbols-outlined">call</i> <span>Contact Us</span></a>
        <a href=""><i class="material-symbols-outlined">settings</i> <span>Settings</span></a>
        <a href=""><i class="material-symbols-outlined">contact_support</i><span>Helps & FAQs</span></a>
      </section>
      <button class="material-symbols-outlined" onclick="closePanel()">close</button>
    </nav>

    <nav class="filter_panel">
      <div class="budget_filter">
        <span style="font-family: 'Alegreya Sans SC', sans-serif; color: white; font-size: 1.5rem;">Budget</span>
        <div>
          <input type="number" placeholder="min GHS" id="min" min="0" oninput="setBudget()">
          <input type="number" placeholder="max GHS" id="max" min="0" oninput="setBudget()">
        </div>
      </div>
      <button class="material-symbols-outlined" onclick="closeFilter()">close</button>
    </nav>

    <section class="intro_box">
      <div>
        <h4>Hungry ?</h4>
        <span style="color: rgb(118, 118, 118);">Place An Order </span>
      </div>
      <a id="vendor_data" data-id="1" href="vendor_profile.html" style="display: flex; align-items: center;">
        <img src="images/flogo2.jpg" alt="">
      </a>
    </section>

    <section class="search_box">
      <input type="text" oninput="runFoodSearch(event.target.value.toLowerCase())">
      <i class="fa-solid fa-sliders" onclick="openFilter()"></i>
    </section>

    <section class="category_box swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="category" data-name="main food">
            <img src="images/beverage.png" alt="">
            <span>Main Foods</span>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="category" data-name="pizza">
            <img src="images/baby1.png" alt="">
            <span>Pizza</span>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="category" data-name="meat">
            <img src="images/baby3.png" alt="">
            <span>Meat</span>
          </div>
        </div>
      </div>
      </div>
    </section>

    <section class="search_swiper_box">
      <h3></h3>
      <section class="search_swiper swiper"></section>
      <span></span>
    </section>

    <section class="food_small_box">
      <h3>Popular</h3>
      <section class="food_smalls swiper">
        <div class="swiper-wrapper">
          <div class="swiper-slide food" data-name="burger" data-price="45" data-cat="main food">
            <div class="food_small" style="background-image: url(images/sample.jpeg);">
              <div>
                <span>Cheese Burger Hamburger</span>
                <small>GHS 45.00</small>
                <button class="add_food" data-id="1" data-name="burger" data-img_url="images/sample.jpeg"
                  data-price="45">Add To Cart</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>
    
    <p>Top Picks</p>
    <section class="food_big_box swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide food" data-name="shrimp fried rice" data-price="60" data-cat="main food">
          <div class="food_big" style="background-image: url(images/shrimp_fried_rice.webp);">
            <div>
              <span>Shrimp Fried Rice</span>
              <small>GHS 60.00</small>
              <button class="add_food" data-id="2" data-name="shrimp fried rice"
                data-img_url="images/shrimp_fried_rice.webp" data-price="60">Add To Cart</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="cart_cover" onclick="toggleCart()"></section>

    <a href="checkout.html" class="cart_total"></a>
    <section class="cart">
      <section class="food_lis"></section>
    </section>
  </section>

  <script src="js/index.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/vendor.js"></script>
  <script>
    const makeFoodSwipers = () => {
      var food_smalls_swiper = new Swiper('.food_smalls', {
        loop: true,
        speed: 500,
      })

      var food_big_swiper = new Swiper('.food_big_box', {
        loop: true,
        speed: 500,
      })

      return [food_smalls_swiper, food_big_swiper]
    }
    makeFoodSwipers()
  </script>
  <script>
    const foods = document.querySelectorAll('.food')
    const categories = document.querySelectorAll('.category')
    const search_swiper_box = document.querySelector('.search_swiper_box')

    const clearSearch = () => {
      search_swiper_box.children[0].innerHTML = ''
      search_swiper_box.children[2].innerHTML = ''
      if (document.querySelector('.search_swiper_nest')) {
        document.querySelector('.search_swiper_nest').remove()
      }
      search_swiper_box.classList.remove('change')
      if (document.querySelector('.search_box input').value === 0) {
        document.querySelector('.search_box input').style.border = 'none'
      }
    }

    const fixSearchSwiper = (res_box, res_count) => {
      search_swiper_box.classList.add('change')
      if (document.querySelector('.search_swiper_nest')) {
        document.querySelector('.search_swiper_nest').remove()
      }
      var search_swiper_nest = document.createElement('div')
      search_swiper_nest.classList.add('swiper-wrapper')
      search_swiper_nest.classList.add('search_swiper_nest')
      document.querySelector('.search_swiper').appendChild(search_swiper_nest)
      search_swiper_nest.innerHTML = ''
      search_swiper_box.children[0].innerHTML = 'Search Box'
      res_box.forEach(el => {
        el.children[0].classList.remove(el.children[0].classList[0])
        el.children[0].classList.add('food_small')
        search_swiper_nest.appendChild(el)
      })
      var search_swiper = new Swiper('.search_swiper', {})
      addToCart(document.querySelectorAll('.add_food'), document.querySelectorAll('.rem_food'))
      search_swiper_box.children[search_swiper_box.children.length - 1].innerHTML = `${res_count} results <i class="material-symbols-outlined" onclick="clearSearch()">close</i>`
      if (res_count === 0) {
        clearSearch()
        document.querySelector('.search_box input').style.border = '2px solid salmon'
      } else {
        document.querySelector('.search_box input').style.border = 'none'
      }
    }

    categories.forEach((cat, i) => {
      cat.onclick = () => {
        var cat_name = cat.dataset.name
        let res_box = []
        let res_count = 0
        foods.forEach((food, ii) => {
          if (cat_name === food.dataset.cat) {
            res_box.push(food.cloneNode(true))
            res_count += 1
          }
        })
        fixSearchSwiper(res_box, res_count)
      }
    })


    setBudget = () => {
      const min = document.getElementById('min')
      const max = document.getElementById('max')

      if (min.value && max.value) {
        let res_box = []
        let res_count = 0
        foods.forEach(food => {
          var price = parseInt(food.dataset.price)
          if (price > min.value && price <= max.value) {
            res_box.push(food.cloneNode(true))
            res_count += 1
          }
        })
        fixSearchSwiper(res_box, res_count)
      } 
    }
    setBudget()

    runFoodSearch = (val) => {
      let res_box = []
      let res_count = 0
      foods.forEach(food => {
        if (val.length > 0) {
          if (food.dataset.name.replace(/\s/g, "").includes(val) || food.dataset.cat.includes(val)) {
            res_box.push(food.cloneNode(true))
            res_count += 1
          }
        }
      })
      fixSearchSwiper(res_box, res_count)
    }
  </script>
  <script>
    addToCart = (add_foods, rem_foods) => {
      add_foods.forEach(add_food => {
        add_food.onclick = () => {
          var blackList = restoreCartState()[1]
          let cart_json = restoreCartState()[0]
          var food_id = add_food.dataset.id
          var food_name = add_food.dataset.name
          var food_feature = add_food.dataset.feature
          var food_price = add_food.dataset.price
          var food_img_url = add_food.dataset.img_url
          var food_vendor = add_food.dataset.vendor
          if (blackList.includes(food_id)) {
            cart_json.forEach(el => {
              if (food_id === el.id) {
                el.quantity = el.quantity + 1
              }
            })
          } else {
            blackList.push(food_id)
            cart_json.push({ id: food_id, name: food_name, feature: food_feature, price: food_price, img_url: food_img_url, vendor: food_vendor, quantity: 1, extras: '' })
          }
          localStorage.setItem(`cart_json${cart_id}`, JSON.stringify(cart_json))
          fixCartState()
          cartSum(cart_json)
          cartCounter(cart_json)
          manageCart()
        }
      })
    }
    addToCart(document.querySelectorAll('.add_food'), document.querySelectorAll('.rem_food'))
  </script>
</body>

</html>