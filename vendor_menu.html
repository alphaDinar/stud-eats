<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/eb75260fb3.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,300,0,0" />
  <link rel="stylesheet" href="css/base.css">
  <title>Document</title>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"
    integrity="sha512-z4OUqw38qNLpn1libAN9BsoDx6nbNFio5lA6CuTp9NlK83b89hgyCVq+N5FdBJptINztxn1Z3SaKSKUS5UP60Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link rel="stylesheet" href="css/component.css">
  <link rel="stylesheet" href="css/vendors.css">
  <link rel="stylesheet" href="css/vendor_menu.css">
  <title>Document</title>
</head>

<body>
  <section class="page">
    <section class="page_cover" onclick="closeFilter()"></section>
    <nav class="top_nav">
      <div>
        <a href="vendors.html" class="material-symbols-outlined">arrow_back</a>
        <img src="images/omar.png" alt="" onclick="openPanel()">
        <small onclick="openPanel()">Hi Omar</small>
      </div>
      <div>
        <i class="material-symbols-outlined">notifications</i>
        <a style="position: relative; display: flex; align-items: center;" onclick="toggleCart()">
          <i class="material-symbols-outlined">shopping_cart</i>
          <small class="cart_counter">0</small>
        </a>
      </div>
    </nav>

    <nav class="user_panel">
      <header>
        <img src="images/omar.png" alt="" width="80px" style="aspect-ratio: 4/3; object-fit: contain;">
        <span>Omar</span>
      </header>
      <section>
        <a href=""><i class="material-symbols-outlined">restaurant</i> <span>My Orders</span></a>
        <a href=""><i class="material-symbols-outlined">person</i> <span>My Profile</span></a>
        <a href=""><i class="material-symbols-outlined">pin_drop</i> <span>Delivery Adderss</span></a>
        <a href=""><i class="material-symbols-outlined">credit_card</i> <span>Payment Methods</span></a>
        <a href=""><i class="material-symbols-outlined">call</i> <span>Contact Us</span></a>
        <a href=""><i class="material-symbols-outlined">settings</i> <span>Settings</span></a>
        <a href=""><i class="material-symbols-outlined">contact_support</i><span>Helps & FAQs</span></a>
      </section>
      <button class="material-symbols-outlined" onclick="closePanel()">close</button>
    </nav>

    <nav class="filter_panel">
      <div class="budget_filter">
        <span style="font-family: 'Alegreya Sans SC', sans-serif; color: white; font-size: 1.5rem;">Budget</span>
        <div>
          <input type="number" placeholder="min GHS" id="min" min="0" oninput="setBudget()">
          <input type="number" placeholder="max GHS" id="max" min="0" oninput="setBudget()">
        </div>
        <small style="color: white;" id="b_res_box">0 Results</small>
      </div>
      <button class="material-symbols-outlined" onclick="closeFilter()">close</button>
    </nav>

    <section class="intro_box">
      <div>
        <h4>Hungry ?</h4>
        <span style="color: rgb(118, 118, 118);">Place An Order </span>
      </div>
      <a href="vendor_profile.html" style="display: flex; align-items: center;">
        <img src="images/flogo2.jpg" alt="">
      </a>
    </section>

    <section class="search_box">
      <input type="text" oninput="runFoodSearch(event.target.value.toLowerCase())">
      <i class="fa-solid fa-sliders" onclick="openFilter()"></i>
    </section>

    <section class="category_box swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="category">
            <img src="images/beverage.png" alt="">
            <span>Beverages</span>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="category">
            <img src="images/baby1.png" alt="">
            <span>Foods</span>
          </div>
        </div>
        <div class="swiper-slide">
          <div class="category">
            <img src="images/baby3.png" alt="">
            <span>Meat</span>
          </div>
        </div>
      </div>
      </div>
    </section>

    <section class="food_small_box">
      <h3>Popular</h3>
      <section class="food_smalls swiper">
        <div class="swiper-wrapper">
          <div class="swiper-slide food" data-name="burger" data-price="45">
            <div class="food_small" style="background-image: url(images/sample.jpeg);">
              <div>
                <span>Cheese Burger Hamburger</span>
                <small>GHS 45.00</small>
                <button class="add_food" data-id="1" data-name="burger"
                data-img_url="images/sample.jpeg" data-price="45">Add To Cart</button>
              </div>
            </div>

            <style>
              .food_smalls .swiper-slide{
                /* border: 2px solid red; */
                display: flex !important;
                justify-content: center;
              }
              .food_small{
                border-radius: 20px;
                border: none;
                height: 220px;
                width: 88%;
                position: relative;
                padding: 10px 5%;
                background-position: center;
                background-size: cover;
              }
              .food_small div{
                position: absolute;
                bottom: 0;
                left: 0;
                /* border-radius: 0 0 0 10px; */
                border-radius: 0 10px 0 10px;
                background: rgba(0, 0, 0, 0.813);
                padding: 10px;
                display: flex;
                gap: 0.5rem 0;
                flex-direction: column;
                align-items: flex-start;
                color: white;
              }
              .food_small div span{
                max-width: 120px;
                font-size: 0.9rem;
              }
              .food_small div small{
                color: lightgray;
              }
              .food_small div button, .food_big div button{
                padding: 10px 20px;
                border-radius: 100px;
              }
            </style>

          </div>
          <div class="swiper-slide food" data-name="shrimp fried rice" data-price="60">
            <div class="food_small" style="background-image: url(images/shrimp_fried_rice.webp);">
              <div>
                <span>Shrimp Fried Rice</span>
                <small>GHS 60.00</small>
                <button class="add_food" data-id="2" data-name="shrimp fried rice"
                data-img_url="images/shrimp_fried_rice.webp" data-price="60">Add To Cart</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>

    <p>Top Picks</p>
    <section class="food_big_box swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide food" data-name="french fries" data-price="30">
          <div class="food_big" style="background-image: url(images/french_fries.png);">
            <div>
              <span>French fries</span>
              <small>GHS 30.00</small>
              <button class="add_food" data-id="3" data-name="french fries"
              data-img_url="images/french_fries.png" data-price="45">Add To Cart</button>
            </div>

            <style>
              .food_big_box{
                margin-bottom: 3vh;
              }
              .food_big{
                height: 200px;
                padding: 10px 0;
                background-position: center;
                background-size: cover;
                display: flex;
                border-radius: 100px;
                position: relative;
                justify-content: flex-end;
                align-items: flex-end;
              }
              .food_big div{
                position: absolute;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                align-items: center;
                height: 50%;
                color: white;
                border-radius: 0 0 100px 100px;
                width: 100%;
                bottom: 0;
                background: rgba(0, 0, 0, 0.813);
              }
              .food_big div span{
                font-size: 0.9rem;
              }
              .food_big div small{
                color: lightgray;
              }
            </style>

          </div>
        </div>
        
      </div>
    </section>

    <section class="cart_cover" onclick="toggleCart()">
    </section>

    <style>
      .cart_cover {
        position: fixed;
        width: 100%;
        height: 100vh;
        top: -100vh;
        left: 0;
        display: flex;
        z-index: 50;
        justify-content: center;
        transition: 0.4s ease;
        background: rgba(0, 0, 0, 0.331);
      }
    </style>

    <a href="map.html" class="cart_total"></a>

    <style>
      .cart_total {
        position: fixed;
        bottom: 10px;
        right: -200px;
        z-index: 200;
        background: var(--var-theme);
        background: orange;
        color: white;
        box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        gap: 0 0.5rem;
        border-radius: 100px;
        transition: 0.4s ease;
      }
      .cart_total.change{
        right: 10px;
      }
    </style>

    <section class="cart">
      <section class="food_lis">
        <div class="food_li">
          <img src="images/shrimp_fried_rice.webp" alt="">
          <section>
            <span>Cheese Burger Hamburger</span>
            <small>GHS 15.50</small>
            <nav>
              <button class="material-symbols-outlined">remove</button>
              <small>10</small>
              <button class="material-symbols-outlined">add</button>
            </nav>

            <i class="material-symbols-outlined">close</i>
          </section>
        </div>



      </section>
      <script>
        const cart = document.querySelector('.cart')
        const cart_cover = document.querySelector('.cart_cover')
        const cart_total = document.querySelector('.cart_total')

        const toggleCart = () => {
          cart.classList.toggle('change')
          cart_cover.classList.toggle('change')
          cart_total.classList.toggle('change')
        }
      </script>

    </section>
    <style>
      .cart {
        width: 90%;
        height: 74vh;
        overflow-y: auto;
        left: 0;
        padding: 3vh 5%;
        z-index: 100;
        position: fixed;
        border-radius: 20px 20px 0 0;
        bottom: -85vh;
        background: white;
      }

      .cart.change {
        bottom: 0;
      }

      .cart_cover.change {
        top: 0;
      }

      .cart {
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: 0.5s ease;
      }

      .food_li {
        background: white;
        width: 100%;
        display: flex;
        gap: 0 1rem;
        padding: 5px;
        position: relative;
        align-items: center;
        border-radius: 10px;
        border: 1px solid darkgray;
      }

      .food_li i {
        position: absolute;
        bottom: 10px;
        right: 10px;
      }

      .food_li section {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.3rem 0;
      }

      .food_li section span {
        width: 150px;
        font-size: 0.85rem;
      }

      .food_li small {
        color: rgb(101, 101, 101);
      }

      .food_li nav {
        display: flex;
        align-items: center;
        gap: 0 0.8rem;
      }

      .food_li button {
        background: var(--var-theme);
        color: white;
        border-radius: 20px;
      }

      .food_lis {
        width: 100%;
        gap: 1rem 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .food_li img {
        width: 80px;
        height: 80px;
        aspect-ratio: 4/3;
        border-radius: 10px;
        object-fit: cover;
        object-position: center;
      }
    </style>
    </style>
  </section>

  

  <script src="js/index.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/vendor.js"></script>

  <script>
    const food_lis = document.querySelector('.food_lis')

    fixCartState = () => {
      let cart_json = restoreCartState()[0]
      food_lis.innerHTML = ''
      cart_json.forEach((el, i) => {
        food_lis.innerHTML += `
        <div class="food_li" id="${el.id}">
          <img src="${el.img_url}" alt="">
          <section>
            <span>Cheese Burger Hamburger</span>
            <small>GHS ${el.price}</small>
            <nav>
              <button class="material-symbols-outlined">remove</button>
              <small>${el.quantity}</small>
              <button class="material-symbols-outlined">add</button>
            </nav>
          </section>
          <i class="material-symbols-outlined">close</i>
        </div>
        `
      })
    }
    fixCartState()

    let cart_json = restoreCartState()[0]
    const sub_sum = document.querySelector('.cart_total')


    cartSum = (cart_json) => {
      var sub_sum_val = 0
      cart_json.forEach(el => {
        var el_sum = el.price * el.quantity
        sub_sum_val = sub_sum_val + el_sum
      })
      sub_sum.innerHTML = `GHS ${sub_sum_val.toLocaleString()} <i class="material-symbols-outlined">shopping_cart_checkout</i>`
      localStorage.setItem('cart_total_json', JSON.stringify({ sub_total: sub_sum_val, delivery_total: 0, cart_total: sub_sum_val }))
    }
    cartSum(cart_json)

    manageCart = () => {
      const cart_lis = document.querySelectorAll('.food_li')
      let cart_json = restoreCartState()[0]
      cart_lis.forEach(li => {
        var li_clear = li.children[2]
        var li_rem = li.children[1].children[2].children[0]
        var li_sum = li.children[1].children[2].children[1]
        var li_add = li.children[1].children[2].children[2]

        console.log(li_clear)

        li_add.onclick = () => {
          cart_json.forEach(el => {
            if (li.id === el.id) {
              el.quantity = el.quantity + 1
              cartCounter(cart_json)
              cartSum(cart_json)
              li_sum.innerHTML = el.quantity
              localStorage.setItem('cart_json', JSON.stringify(cart_json))
            }
          })
        }
        li_rem.onclick = () => {
          cart_json.forEach(el => {
            if (li.id === el.id) {
              if (el.quantity === 1) {
                cart_json.splice(cart_json.indexOf(el), 1)
                anime({
                  targets: li,
                  duration: 500,
                  translateX: [0, -100],
                  opacity: [1, 0],
                  easing: 'easeInOutExpo',
                  complete: () => {
                    li.remove()
                  }
                })
              } else {
                el.quantity = el.quantity - 1
              }
              cartCounter(cart_json)
              cartSum(cart_json)
              li_sum.innerHTML = el.quantity
              localStorage.setItem('cart_json', JSON.stringify(cart_json))
            }
          })
        }
        li_clear.onclick = () => {
          cart_json.forEach(el => {
            if (li.id === el.id) {
              cart_json.splice(cart_json.indexOf(el), 1)
              anime({
                targets: li,
                duration: 500,
                translateX: [0, -100],
                opacity: [1, 0],
                easing: 'easeInOutExpo',
                complete: () => {
                  li.remove()
                }
              })
              cartCounter(cart_json)
              cartSum(cart_json)
              li_sum.innerHTML = el.quantity
              localStorage.setItem('cart_json', JSON.stringify(cart_json))
            }
          })
        }
      })
    }
    manageCart()
  </script>

  <script>
    const makeFoodSwipers = () => {
      var food_smalls_swiper = new Swiper('.food_smalls', {
        loop: true,
        speed: 500,
        // slidesPerView: 2,
        // spaceBetween: 15
      })

      var food_big_swiper = new Swiper('.food_big_box', {
        loop: true,
        speed: 1000,
      })
    }
    makeFoodSwipers()
  </script>
  <script>
    const foods = document.querySelectorAll('.food')

    setBudget = () => {
      const b_res_box = document.getElementById('b_res_box')
      const min = document.getElementById('min')
      const max = document.getElementById('max')

      if (min.value && max.value) {
        let res_count = 0
        foods.forEach(food => {
          var price = parseInt(food.dataset.price)
          if (price > min.value && price <= max.value) {
            res_count += 1
            food.style.display = 'block'
          } else {
            food.style.display = 'none'
          }
          b_res_box.innerHTML = `${res_count} Results`
          runSearchAnime(food)
        })
        makeFoodSwipers()
      } else {
        foods.forEach(food => {
          food.style.display = 'block'
        })
        b_res_box.innerHTML = `${foods.length} Results`
        makeFoodSwipers()
      }
    }
    setBudget()

    runFoodSearch = (val) => {
      foods.forEach(food => {
        if (food.dataset.name.replace(/\s/g, "").includes(val) || food.dataset.feature.includes(val)) {
          food.style.display = 'block'
        } else {
          food.style.display = 'none'
        }
        runSearchAnime(food)
      })
      makeFoodSwipers()
    }
  </script>
  <script>
    const add_foods = document.querySelectorAll('.add_food')

    console.log(add_foods)
    const rem_foods = document.querySelectorAll('.rem_food')
    // var cart_json = restoreCartState()[0]
    var blackList = restoreCartState()[1]

    addToCart = () => {
      add_foods.forEach(add_food => {
        add_food.onclick = () => {
          console.log('me')
          var food_id = add_food.dataset.id
          var food_name = add_food.dataset.name
          var food_feature = add_food.dataset.feature
          var food_price = add_food.dataset.price
          var food_img_url = add_food.dataset.img_url
          var food_vendor = add_food.dataset.vendor
          if (blackList.includes(food_id)) {
            cart_json.forEach(el => {
              if (food_id === el.id) {
                el.quantity = el.quantity + 1
              }
            })
          } else {
            blackList.push(food_id)
            cart_json.push({ id: food_id, name: food_name, feature: food_feature, price: food_price, img_url: food_img_url, vendor: food_vendor, quantity: 1, extras: '' })
          }
          localStorage.setItem('cart_json', JSON.stringify(cart_json))
          fixCartState()
          cartSum(cart_json)
          cartCounter(cart_json)
          manageCart()
        }
      })
    }
    addToCart()

    remFromCart = () => {
      rem_foods.forEach(rem_food => {
        rem_food.onclick = () => {
          var food_id = rem_food.dataset.id
          if (blackList.includes(food_id)) {
            cart_json.forEach(el => {
              if (food_id === el.id) {
                if (el.quantity > 1) {
                  console.log(el.quantity)
                  el.quantity = el.quantity - 1
                }
                else {
                  cart_json.splice(cart_json.indexOf(el), 1)
                  blackList.splice(blackList.indexOf(String(el.id)), 1)
                }
              }
            })
          }
          localStorage.setItem('cart_json', JSON.stringify(cart_json))
          cartCounter(cart_json)
        }
      })
    }
    remFromCart()
  </script>
</body>

</html>